<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#183c2f">
  <title>TeamWeave</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="bg-shapes" aria-hidden="true"></div>

  <header class="hero">
    <div class="hero-content">
      <p class="eyebrow">PWA Offline</p>
      <h1>TeamWeave</h1>
      <p class="subtitle">Carica il CSV del modulo e ottieni matrici, indicatori e rete dei reciproci positivi.</p>
    </div>
  </header>

  <main class="main">
    <nav class="main-tabs" aria-label="Sezioni principali">
      <button class="main-tab active" data-main="analysis">Analisi test</button>
      <button class="main-tab" data-main="generator">Generatore test</button>
    </nav>

    <section id="analysis-section">
      <section class="panel upload-panel">
      <h2>Caricamento dati</h2>
      <p>Il CSV deve avere le stesse colonne del primo foglio Excel (timestamp, nome, domande in ordine). Le colonne pari sono positive, le dispari negative.</p>
      <div class="upload-row">
        <input id="file-input" type="file" accept=".csv" multiple />
      </div>
      <div class="upload-row">
        <button id="export-link-btn" type="button">Genera codice dati</button>
        <button id="export-csv-btn" type="button">Scarica CSV</button>
        <button id="export-html-btn" type="button">Esporta HTML</button>
      </div>
      <div id="export-box" class="export-box hidden">
        <label for="export-link">Codice dati</label>
        <div class="export-row">
          <input id="export-link" type="text" readonly />
          <button id="copy-link-btn" type="button">Copia</button>
        </div>
        <p class="note">Il codice contiene i dati del CSV. Condividilo solo con chi deve vederli.</p>
      </div>
      <div class="import-box">
        <label for="import-code">Importa da codice</label>
        <textarea id="import-code" rows="4" placeholder="Incolla qui il codice dati..."></textarea>
        <button id="import-code-btn" type="button">Importa codice</button>
      </div>
      <div id="dataset-box" class="dataset-box hidden">
        <div class="dataset-row">
          <label for="dataset-select">Dataset attivo</label>
          <select id="dataset-select"></select>
        </div>
        <div class="dataset-row">
          <button id="delete-dataset-btn" type="button">Rimuovi dataset</button>
        </div>
        <div class="dataset-row dataset-manager-row">
          <label>Dataset visibili e ordine A/B</label>
          <div id="dataset-manager" class="dataset-manager"></div>
        </div>
        <div id="compare-row" class="dataset-row">
          <label for="compare-a">Confronto</label>
          <div class="compare-selects">
            <select id="compare-a"></select>
            <select id="compare-b"></select>
          </div>
        </div>
        <p id="compare-note" class="note">Delta mostrata come B - A.</p>
      </div>
      <div id="status" class="status" role="status"></div>
    </section>

    <section id="summary" class="summary hidden">
      <div class="summary-card">
        <span class="label">Atlete</span>
        <strong id="summary-athletes">0</strong>
      </div>
      <div class="summary-card summary-card-pos">
        <span class="label">Indice reciprocita +</span>
        <strong id="summary-reciproci-pos">0%</strong>
      </div>
      <div class="summary-card summary-card-neg">
        <span class="label">Indice reciprocita -</span>
        <strong id="summary-reciproci-neg">0%</strong>
      </div>
    </section>

    <section id="views" class="views hidden">
      <nav class="tabs" aria-label="Sezioni analisi">
        <button class="tab active" data-view="responses">Risposte</button>
        <button class="tab" data-view="top-domande">Top domande</button>
        <button class="tab" data-view="top-ricevute">Top ricevute</button>
        <button class="tab" data-view="matrix-pos">Matrice +</button>
        <button class="tab" data-view="matrix-neg">Matrice -</button>
        <button class="tab" data-view="reciproci-pos">Reciproci +</button>
        <button class="tab" data-view="reciproci-neg">Reciproci -</button>
        <button class="tab" data-view="forza-legami">Forza legami</button>
        <button class="tab" data-view="forza-antagonismo">Forza antagonismo</button>
        <button class="tab" data-view="non-ricambiate">Positive non ricambiate</button>
        <button class="tab" data-view="riassunto">Dati riassuntivi</button>
        <button class="tab" data-view="confronto">Confronto</button>
      </nav>

    <section id="view-container" class="view-container"></section>
    </section>
    </section>

    <section id="generator-section" class="panel hidden">
      <h2>Generatore test</h2>
      <p class="note">Incolla giocatrici e domande per generare lo script App Script del test TeamWeave.
Lo script generato va utilizzato sugli script di google per generare il Google Form corrispondente al test.
Ogni domanda positiva deve essere seguita dal suo corrispettivo negativo, non ci possono essere domande senza una delle due parti, il programma prende automaticamente una domanda dopo l'altra, la prima come positiva e la seconda come negativa.<br>
Procedura da seguire:<br>
1) Compila i campi con l'elenco delle giocatrici e l'elenco di domande.<br>
2) Dopo aver compilato le domande, compariranno nel selezionatore di categoria. Seleziona la categoria a cui appartiene ogni gruppo di domande. Se le domande vengono da un test precedente, hanno il tag della categoria, che viene automaticamente riconosciuto dal programma e pre impostato. Dopo aver selezionato le categorie, puoi scaricare le domande in un file di testo con il tag di categoria gia' impostato, in modo da poterlo utilizzare in test successivi senza selezionare a mano le categorie.<br>
3) Clicca “Genera script”.<br>
4) In Google Drive crea un nuovo foglio “Apps Script” o usa quello che hai già usato per gli altri test, incolla lo script e salvalo.<br>
5) Premi “Esegui” per creare il form. Lo troverai nel tuo Google Drive e nel link che ti viene fornito dopo l'esecuzione.<br>
6) Apri il form, applica le modifiche che preferisci e poi fallo compilare alla squadra.<br>
7) Una volta raccolte tutte le risposte, collega il form a un Foglio Google tramite l'apposito tasto.<br>
8) Scarica il foglio Google come file .csv e caricalo nella tab di analisi per aggiungerlo ai test analizzati. Puoi confrontare e analizzare fino a 2 test contemporaneamente.<br></p>
      <div class="form-grid">
        <label for="tw-form-title">Titolo del form</label>
        <input id="tw-form-title" type="text" value="Test Sociometrico [Squadra]" />
        <label for="tw-form-limit">Numero selezioni</label>
        <input id="tw-form-limit" type="number" value="3" min="1" />
      </div>
      <label for="tw-form-players">Giocatrici (una per riga)</label>
      <textarea id="tw-form-players" class="tall" rows="6" placeholder="Giocatrice 1&#10;Giocatrice 2&#10;Giocatrice 3"></textarea>
      <label for="tw-form-questions">Domande (una per riga)</label>
      <textarea id="tw-form-questions" class="tall" rows="6" placeholder="Immagina di andare in trasferta. Chi vorresti in camera con te?&#10;Immagina di andare in trasferta. Chi non vorresti in camera con te?&#10;Immagina di giocare una partita decisiva. Chi vorresti con te in campo?&#10;Chi non vorresti con te in campo in una partita decisiva?"></textarea>
      <div class="tw-categories">
        <h3>Categorie per coppia di domande</h3>
        <p class="note">Ogni coppia (positiva + negativa) condivide la stessa categoria.</p>
        <div id="tw-form-categories" class="tw-category-list"></div>
      </div>
      <div class="upload-row">
        <button id="tw-form-convert" type="button">Genera script</button>
        <button id="tw-form-copy" type="button">Copia script</button>
        <button id="tw-form-download" type="button">Scarica .gs</button>
        <button id="tw-form-download-questions" type="button">Scarica domande .txt</button>
      </div>
      <div class="result pre" id="tw-form-output">function buildTeamWeaveForm() { /* clicca Genera */ }</div>
      <div class="parsed" id="tw-form-preview"></div>
    </section>
  </main>

  <footer class="footer">
    <p>Analisi locale: i dati restano sul dispositivo.</p>
  </footer>

  <script src="app.js"></script>
</body>
</html>
